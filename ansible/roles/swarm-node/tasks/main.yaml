  - name: Gather facts
    action: ec2_facts
  - name: nginx conf dir 
    file: path=/etc/nginx/conf.d state=directory mode=0755
  - name: copy nginx conf 
    copy: src="{{ item }}" dest=/etc/nginx/conf.d
    with_items:
       - backend.conf 
       - nginx.crt
       - nginx.key
  - name: copy docker-compose.yaml 
    copy: src="docker-compose.yaml" dest=/opt/docker-compose.yaml
  - name: Register node with elb 
    sudo : no
    local_action:
      module: ec2_elb
      instance_id: "{{ ansible_ec2_instance_id }}"
      ec2_elbs: "swarm-elb"
      state: 'present'
      region : "{{ aws_region }}"
      enable_availability_zone : "yes"
