  - name: Gather facts
    action: ec2_facts
  - name: set fact
    set_fact: consul_network="{{ ansible_ec2_local_ipv4 }}"
  - name: run consul
    docker: 
      name: consul
      image: progrium/consul
      state: started
      command: "-server -bootstrap"
      detach: True
      restart_policy: always
      ports:
      - "8500:8500"    
  - name: run consul network
    docker: 
      name: consul-network
      image: progrium/consul
      state: started
      command: "-server -bootstrap"
      detach: True
      restart_policy: always
      ports:
      - "8501:8501"
